{{ $kcp := index .Values.services "kcp" }}
{{- if $kcp.enabled -}}
apiVersion: delivery.ocm.software/v1alpha1
kind: Resource
metadata:
  name: kcp-image
  labels:
    infra: "true"
    component: infra
spec:
  componentRef:
    name: {{ .Values.ocm.component.name }}
  resource:
    byReference:
      resource:
        name: image
      referencePath:
        {{- with .Values.ocm.referencePath }}
        {{- toYaml . | nindent 8 }}
        {{- end }}
        - name: kcp
  interval: 1m
  ocmConfig:
    - kind: Repository
      apiVersion: delivery.ocm.software/v1alpha1
      name: {{ .Values.ocm.repo.name }}
      namespace: {{ .Release.Namespace }}
---
{{ end -}}
