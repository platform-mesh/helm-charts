# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Test the application manifests
release:
  name: infra
  namespace: platform-mesh-system
tests:
- it: match snapshots
  set:
    kcp:
      image:
        tag: 0.0.0
  asserts:
  - matchSnapshot: {}
- it: match snapshots w. hostAliases enabled
  set:
    kcp:
      frontProxy:
        clusterIP: "10.0.0.1"
    hostAliases:
      enabled: true
  asserts:
    - matchSnapshot: {}
- it: match snapshots w. kcp version
  set:
    kcp:
      image:
        tag: "v0.1.0"
  asserts:
    - matchSnapshot: {}
- it: match snapshots with mailpit enabled
  set:
    mailpit:
      enabled: true
  asserts:
  - matchSnapshot: {}
- it: Gateway API enabled
  set:
    gatewayApi:
      enabled: true
    cors:
      enabled: true
  asserts:
    - matchSnapshot: {}
- it: Istio disabled
  set:
    istio:
      enabled: false
  asserts:
    - matchSnapshot: {}
- it: Istio enabled
  set:
    istio:
      enabled: true
  asserts:
    - matchSnapshot: {}
- it: configure gateway TLS credential namespace
  templates:
    - gatewayapi/gateway.yaml
  set:
    gatewayApi:
      enabled: true
      main:
        gateway:
          tls:
            credentialName: domain-certificate
            credentialNamespace: default2
  asserts:
  - equal:
      path: spec.listeners[0].tls.certificateRefs[0].namespace
      value: default2