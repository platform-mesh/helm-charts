should create all resources when enabled with same namespace:
  1: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
  2: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    rules:
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-admin
        resources:
          - secrets
        verbs:
          - get
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-provider-config
        resources:
          - secrets
        verbs:
          - get
          - create
          - update
          - patch
          - delete
  3: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: keycloak-provider-config-secret-creator
    subjects:
      - kind: ServiceAccount
        name: keycloak-provider-config-secret-creator
        namespace: platform-mesh-system
  4: |
    apiVersion: batch/v1
    kind: Job
    metadata:
      annotations:
        helm.sh/hook: post-install,post-upgrade
        helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
        helm.sh/hook-weight: "1"
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    spec:
      template:
        metadata:
          name: keycloak-provider-config-secret-creator
        spec:
          containers:
            - command:
                - /bin/sh
                - -c
                - |-
                  set -e

                  # Read the keycloak-admin secret
                  echo "Reading keycloak-admin secret..."
                  ADMIN_SECRET=$(kubectl get secret keycloak-admin -n platform-mesh-system -o jsonpath='{.data.secret}' 2>/dev/null || echo "")

                  if [ -z "$ADMIN_SECRET" ]; then
                    echo "Warning: keycloak-admin secret not found or secret key missing, using default password"
                    PASSWORD="aesaeXaefu0x"
                  else
                    # Decode base64 password
                    PASSWORD=$(echo "$ADMIN_SECRET" | base64 -d)
                  fi

                  # Escape password for JSON (escape backslashes, quotes, and newlines)
                  ESCAPED_PASSWORD=$(echo -n "$PASSWORD" | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')

                  # Create the provider config JSON using printf to avoid shell expansion issues
                  CONFIG_JSON=$(printf '{"client_id":"admin-cli","username":"keycloak-admin","password":"%s","url":"http://keycloak.platform-mesh-system.svc.cluster.local/keycloak","realm":"master"}' "$ESCAPED_PASSWORD")

                  # Check if secret already exists
                  if kubectl get secret keycloak-provider-config -n platform-mesh-system &>/dev/null; then
                    echo "Updating existing secret keycloak-provider-config..."
                    # Delete and recreate to ensure clean state
                    kubectl delete secret keycloak-provider-config -n platform-mesh-system --ignore-not-found=true
                  fi

                  echo "Creating secret keycloak-provider-config..."
                  kubectl create secret generic keycloak-provider-config \
                    --from-literal=config="$CONFIG_JSON" \
                    -n platform-mesh-system

                  echo "Secret keycloak-provider-config created/updated successfully"
              image: ghcr.io/platform-mesh/images/ocmbuilder:pr-4
              name: secret-creator
          restartPolicy: OnFailure
          serviceAccountName: keycloak-provider-config-secret-creator
should create all resources when namespaces differ:
  1: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: custom-namespace
  2: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: keycloak-provider-config-secret-reader
      namespace: platform-mesh-system
    rules:
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-admin
        resources:
          - secrets
        verbs:
          - get
  3: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: keycloak-provider-config-secret-reader
      namespace: platform-mesh-system
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: keycloak-provider-config-secret-reader
    subjects:
      - kind: ServiceAccount
        name: keycloak-provider-config-secret-creator
        namespace: custom-namespace
  4: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: custom-namespace
    rules:
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-provider-config
        resources:
          - secrets
        verbs:
          - get
          - create
          - update
          - patch
          - delete
  5: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: custom-namespace
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: keycloak-provider-config-secret-creator
    subjects:
      - kind: ServiceAccount
        name: keycloak-provider-config-secret-creator
        namespace: custom-namespace
  6: |
    apiVersion: batch/v1
    kind: Job
    metadata:
      annotations:
        helm.sh/hook: post-install,post-upgrade
        helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
        helm.sh/hook-weight: "1"
      name: keycloak-provider-config-secret-creator
      namespace: custom-namespace
    spec:
      template:
        metadata:
          name: keycloak-provider-config-secret-creator
        spec:
          containers:
            - command:
                - /bin/sh
                - -c
                - |-
                  set -e

                  # Read the keycloak-admin secret
                  echo "Reading keycloak-admin secret..."
                  ADMIN_SECRET=$(kubectl get secret keycloak-admin -n platform-mesh-system -o jsonpath='{.data.secret}' 2>/dev/null || echo "")

                  if [ -z "$ADMIN_SECRET" ]; then
                    echo "Warning: keycloak-admin secret not found or secret key missing, using default password"
                    PASSWORD="aesaeXaefu0x"
                  else
                    # Decode base64 password
                    PASSWORD=$(echo "$ADMIN_SECRET" | base64 -d)
                  fi

                  # Escape password for JSON (escape backslashes, quotes, and newlines)
                  ESCAPED_PASSWORD=$(echo -n "$PASSWORD" | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')

                  # Create the provider config JSON using printf to avoid shell expansion issues
                  CONFIG_JSON=$(printf '{"client_id":"admin-cli","username":"keycloak-admin","password":"%s","url":"http://keycloak.platform-mesh-system.svc.cluster.local/keycloak","realm":"master"}' "$ESCAPED_PASSWORD")

                  # Check if secret already exists
                  if kubectl get secret keycloak-provider-config -n custom-namespace &>/dev/null; then
                    echo "Updating existing secret keycloak-provider-config..."
                    # Delete and recreate to ensure clean state
                    kubectl delete secret keycloak-provider-config -n custom-namespace --ignore-not-found=true
                  fi

                  echo "Creating secret keycloak-provider-config..."
                  kubectl create secret generic keycloak-provider-config \
                    --from-literal=config="$CONFIG_JSON" \
                    -n custom-namespace

                  echo "Secret keycloak-provider-config created/updated successfully"
              image: ghcr.io/platform-mesh/images/ocmbuilder:pr-4
              name: secret-creator
          restartPolicy: OnFailure
          serviceAccountName: keycloak-provider-config-secret-creator
should have Job with correct annotations:
  1: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
  2: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    rules:
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-admin
        resources:
          - secrets
        verbs:
          - get
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-provider-config
        resources:
          - secrets
        verbs:
          - get
          - create
          - update
          - patch
          - delete
  3: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: keycloak-provider-config-secret-creator
    subjects:
      - kind: ServiceAccount
        name: keycloak-provider-config-secret-creator
        namespace: platform-mesh-system
  4: |
    apiVersion: batch/v1
    kind: Job
    metadata:
      annotations:
        helm.sh/hook: post-install,post-upgrade
        helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
        helm.sh/hook-weight: "1"
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    spec:
      template:
        metadata:
          name: keycloak-provider-config-secret-creator
        spec:
          containers:
            - command:
                - /bin/sh
                - -c
                - |-
                  set -e

                  # Read the keycloak-admin secret
                  echo "Reading keycloak-admin secret..."
                  ADMIN_SECRET=$(kubectl get secret keycloak-admin -n platform-mesh-system -o jsonpath='{.data.secret}' 2>/dev/null || echo "")

                  if [ -z "$ADMIN_SECRET" ]; then
                    echo "Warning: keycloak-admin secret not found or secret key missing, using default password"
                    PASSWORD="aesaeXaefu0x"
                  else
                    # Decode base64 password
                    PASSWORD=$(echo "$ADMIN_SECRET" | base64 -d)
                  fi

                  # Escape password for JSON (escape backslashes, quotes, and newlines)
                  ESCAPED_PASSWORD=$(echo -n "$PASSWORD" | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')

                  # Create the provider config JSON using printf to avoid shell expansion issues
                  CONFIG_JSON=$(printf '{"client_id":"admin-cli","username":"keycloak-admin","password":"%s","url":"http://keycloak.platform-mesh-system.svc.cluster.local/keycloak","realm":"master"}' "$ESCAPED_PASSWORD")

                  # Check if secret already exists
                  if kubectl get secret keycloak-provider-config -n platform-mesh-system &>/dev/null; then
                    echo "Updating existing secret keycloak-provider-config..."
                    # Delete and recreate to ensure clean state
                    kubectl delete secret keycloak-provider-config -n platform-mesh-system --ignore-not-found=true
                  fi

                  echo "Creating secret keycloak-provider-config..."
                  kubectl create secret generic keycloak-provider-config \
                    --from-literal=config="$CONFIG_JSON" \
                    -n platform-mesh-system

                  echo "Secret keycloak-provider-config created/updated successfully"
              image: ghcr.io/platform-mesh/images/ocmbuilder:pr-4
              name: secret-creator
          restartPolicy: OnFailure
          serviceAccountName: keycloak-provider-config-secret-creator
should have Job with correct configuration:
  1: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
  2: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    rules:
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-admin
        resources:
          - secrets
        verbs:
          - get
      - apiGroups:
          - ""
        resourceNames:
          - keycloak-provider-config
        resources:
          - secrets
        verbs:
          - get
          - create
          - update
          - patch
          - delete
  3: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: keycloak-provider-config-secret-creator
    subjects:
      - kind: ServiceAccount
        name: keycloak-provider-config-secret-creator
        namespace: platform-mesh-system
  4: |
    apiVersion: batch/v1
    kind: Job
    metadata:
      annotations:
        helm.sh/hook: post-install,post-upgrade
        helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
        helm.sh/hook-weight: "1"
      name: keycloak-provider-config-secret-creator
      namespace: platform-mesh-system
    spec:
      template:
        metadata:
          name: keycloak-provider-config-secret-creator
        spec:
          containers:
            - command:
                - /bin/sh
                - -c
                - |-
                  set -e

                  # Read the keycloak-admin secret
                  echo "Reading keycloak-admin secret..."
                  ADMIN_SECRET=$(kubectl get secret keycloak-admin -n platform-mesh-system -o jsonpath='{.data.secret}' 2>/dev/null || echo "")

                  if [ -z "$ADMIN_SECRET" ]; then
                    echo "Warning: keycloak-admin secret not found or secret key missing, using default password"
                    PASSWORD="aesaeXaefu0x"
                  else
                    # Decode base64 password
                    PASSWORD=$(echo "$ADMIN_SECRET" | base64 -d)
                  fi

                  # Escape password for JSON (escape backslashes, quotes, and newlines)
                  ESCAPED_PASSWORD=$(echo -n "$PASSWORD" | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')

                  # Create the provider config JSON using printf to avoid shell expansion issues
                  CONFIG_JSON=$(printf '{"client_id":"admin-cli","username":"keycloak-admin","password":"%s","url":"http://keycloak.platform-mesh-system.svc.cluster.local/keycloak","realm":"master"}' "$ESCAPED_PASSWORD")

                  # Check if secret already exists
                  if kubectl get secret keycloak-provider-config -n platform-mesh-system &>/dev/null; then
                    echo "Updating existing secret keycloak-provider-config..."
                    # Delete and recreate to ensure clean state
                    kubectl delete secret keycloak-provider-config -n platform-mesh-system --ignore-not-found=true
                  fi

                  echo "Creating secret keycloak-provider-config..."
                  kubectl create secret generic keycloak-provider-config \
                    --from-literal=config="$CONFIG_JSON" \
                    -n platform-mesh-system

                  echo "Secret keycloak-provider-config created/updated successfully"
              image: ghcr.io/platform-mesh/images/ocmbuilder:pr-4
              name: secret-creator
          restartPolicy: OnFailure
          serviceAccountName: keycloak-provider-config-secret-creator
