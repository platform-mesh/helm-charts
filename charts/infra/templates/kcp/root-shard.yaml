apiVersion: operator.kcp.io/v1alpha1
kind: RootShard
metadata:
  name: root
  namespace: {{ .Values.kcp.namespace | default "kcp-system" }}
spec:
  shardBaseURL: https://root.{{ .Values.kcp.shards.domain }}:8443
  {{ include "kcpShardCommonValues" $ }}
---
{{- if .Values.gatewayApi.enabled }}
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TLSRoute
metadata:
  name: kcp-root
  namespace: {{ .Values.kcp.namespace | default "kcp-system" }}
spec:
  hostnames:
  - root.{{ .Values.kcp.shards.domain }}
  parentRefs:
  - group: gateway.networking.k8s.io
    kind: Gateway
    name: {{ .Values.gatewayApi.name }}
    sectionName: {{ .Values.gatewayApi.passThrough.gateway.name }}
  rules:
  - backendRefs:
    - group: ""
      kind: Service
      name: root-kcp
      port: 6443
    {{- if .Values.cors.enabled }}
    filters:
    {{- toYaml .Values.gatewayApi.httpRoute.corsFilters | nindent 4 }}
    {{- end }}
{{- end }}
