apiVersion: operator.kcp.io/v1alpha1
kind: FrontProxy
metadata:
  name: {{.Values.kcp.frontProxy.name }}
  namespace: {{ .Values.kcp.namespace | default "kcp-system" }}
spec:
  replicas: {{ .Values.kcp.frontProxy.replicas }}
  auth:
    {{- if .Values.kcp.oidc.enabled }}
    {{ with .Values.kcp.oidc }}
    oidc:
      enabled: true
      issuerURL: {{ .issuerUrl }}
      clientID: {{ .clientID }}
      groupsClaim: {{ .groupsClaim }}
      usernameClaim: {{ .usernameClaim }}
    {{- end }}
    {{- end }}

  additionalPathMappings:
{{ toYaml .Values.kcp.frontProxy.additionalPathMappings | indent 4 }}
  rootShard:
    ref:
      name: root
  serviceTemplate:
    spec:
      type: ClusterIP
  {{- with .Values.kcp.frontProxy.clusterIP }}
      clusterIP: {{ . }}
  {{- end }}
  {{- with .Values.kcp.frontProxy.port }}
      ports:
      - appProtocol: https
        name: https
        port: {{ . }}
        protocol: TCP
        targetPort: 6443
  {{- end }}
  {{- if .Values.hostAliases.enabled }}
  {{- with .Values.hostAliases.entries }}
  deploymentTemplate:
    spec:
      template:
        spec:
          hostAliases:
            {{ toYaml . | nindent 12 }}
  {{- end }}
  {{- end }}