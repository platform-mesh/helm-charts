hostAliases:
  enabled: false
  entries:
    - ip: "10.96.188.4"
      hostnames:
        - "localhost"
        - "portal.localhost"

externalSecrets:
  enabled: false

kcp:
  image:
    tag: ""
  namespace: platform-mesh-system
  external:
    hostname: localhost
    port: 8443
  auth:
    adminCert:
      enabled: true
      privateKey:
        algorithm: RSA
        size: 2048
      subject:
        organizations:
          - system:kcp:admin
    serviceAccounts:
      enabled: true
    oidc:
      enabled: false
      issuerUrl: ""
      clientID: ""
      groupsClaim: groups
      usernameClaim: email
      caFileRef:
        name: domain-certificate-ca
        key: tls.crt
  etcd:
    name: etcd-kcp
    service:
      name: etcd-kcp-client
      port: 2379
    defragmentationSchedule: "0 */24 * * *"
    resources:
      limits:
        cpu: 500m
        memory: 1Gi
      requests:
        cpu: 100m
        memory: 200Mi
    serverPort: 2380
    quota: 8Gi
    backup:
      port: 8080
      fullSnapshotSchedule: "0 */24 * * *"
      resources:
        limits:
          cpu: 200m
          memory: 1Gi
        requests:
          cpu: 23m
          memory: 128Mi
      garbageCollectionPolicy: Exponential
      garbageCollectionPeriod: 43200s
      deltaSnapshotPeriod: 300s
      deltaSnapshotMemoryLimit: 1Gi
      compression:
        enabled: false
        policy: "gzip"
      leaderElection:
        reelectionPeriod: 5s
        etcdConnectionTimeout: 5s
      # store:
      #   container: etcd-bucket
      #   prefix: etcd-test
      #   provider: S3
      #   endpointOverride: http://localstack.default:4566
      #   secretRef:
      #     name: etcd-backup-aws
    sharedConfig:
      autoCompactionMode: periodic
      autoCompactionRetention: "30m"
    replicas: 1

  webhook:
    enabled: true
    caData: ""
    server: https://rebac-authz-webhook.platform-mesh-system.svc.cluster.local:9443/authz
    authorizationWebhookSecretName: kcp-webhook-secret
    port: 9443

  rootShard:
    replicas: 1
    # -- Optional resource requests and limits for the root shard
    resources: {}
    # resources:
    #   limits:
    #     cpu: "2"
    #     memory: "2Gi"
    #   requests:
    #     cpu: "1"
    #     memory: "1Gi"
    extraArgs:
    - --feature-gates=WorkspaceAuthentication=true
  frontProxy:
    replicas: 1
    name: frontproxy
    clusterIP: ""
    port: 8443
    # -- Optional resource requests and limits for the front proxy
    resources: {}
    # resources:
    #   limits:
    #     cpu: 500m
    #     memory: 512Mi
    #   requests:
    #     cpu: 100m
    #     memory: 128Mi
    additionalPathMappings:
      - path: /services/contentconfigurations
        backend: https://virtual-workspaces.platform-mesh-system:8443
        backend_server_ca: /etc/kcp/tls/ca/tls.crt
        proxy_client_cert: /etc/kcp-front-proxy/requestheader-client/tls.crt
        proxy_client_key: /etc/kcp-front-proxy/requestheader-client/tls.key
      - path: /services/marketplace
        backend: https://virtual-workspaces.platform-mesh-system:8443
        backend_server_ca: /etc/kcp/tls/ca/tls.crt
        proxy_client_cert: /etc/kcp-front-proxy/requestheader-client/tls.crt
        proxy_client_key: /etc/kcp-front-proxy/requestheader-client/tls.key
    extraArgs:
    - --feature-gates=WorkspaceAuthentication=true

openfga:
  rbac:
    writePrincipals:
      - cluster.local/ns/platform-mesh-system/sa/iam-service
      - cluster.local/ns/platform-mesh-system/sa/security-operator
      - cluster.local/ns/platform-mesh-system/sa/account-operator

traefik:
  # -- toggle to enable traefik CORS filter in HTTPRoute
  enabled: true
  # -- list of origins allowed for CORS (used by Traefik middleware)
  accessControlAllowOriginList: []

keycloak:
  gatewayApi:
    # -- hostnames for the Keycloak HTTPRoute
    hostnames:
      - portal.localhost
    # -- path prefix for the Keycloak HTTPRoute
    pathPrefix: /keycloak
    # -- list of HTTPRoute filters (default: none)
    filters: []
    # -- CORS filter referencing traefik middleware (used when traefik.enabled=true)
    corsFilters:
      - type: ExtensionRef
        extensionRef:
          group: traefik.io
          kind: Middleware
          name: cors-header

  # -- service configuration
  service:
    # -- service name
    name: keycloak
    # -- service port
    port: 80

  # -- domain configuration
  domain:
    # -- domain name
    name: platform-mesh.io
    # -- path prefix
    pathPrefix: "/keycloak"

  keycloakConfig:
    # -- url of the keycloak server
    url: http://keycloak.platform-mesh-system.svc.cluster.local/keycloak
    userRegistration:
      # -- toggle to enable/disable user registration
      enabled: true
    # -- redirect urls
    redirectUrls: ["http://localhost:8000/callback*"]
    # -- realm configuration
    realm:
      # -- realm name
      name: master
    # -- client configuration
    client:
      # -- client name
      name: welcome
      # -- target secret options
      targetSecret:
        # -- secret name
        name: portal-client-secret-welcome
        # -- secret namespace
        namespace: platform-mesh-system
      # -- token lifespan
      tokenLifespan: 3600
    # -- admin user configuration
    admin:
      username:
        # -- username
        value: keycloak-admin
      # -- admin password
      password:
        valueFrom:
          secretKeyRef:
            # -- name of the secret containing the password
            name: keycloak-admin
            # -- key of the password in the secret
            key: secret

gatewayApi:
  # -- Toggle to enable/disable Gateway API resources
  enabled: true
  # -- Name of the Gateway resource
  name: k8sapi-gateway
  # -- GatewayClass name
  gatewayClassName: traefik
  # -- HTTPS Terminate configuration
  infrastructure: {}
  listeners:
    - name: terminate
      hostname: portal.localhost
      port: 8443
      protocol: HTTPS
      tls:
        mode: Terminate
        certificateRefs:
          - group: ""
            kind: Secret
            name: domain-certificate
            namespace: platform-mesh-system
    - name: terminate-wildstar
      hostname: '*.portal.localhost'
      port: 8443
      protocol: HTTPS
      tls:
        mode: Terminate
        certificateRefs:
          - group: ""
            kind: Secret
            name: domain-certificate
            namespace: platform-mesh-system
    - name: passthrough
      port: 8443
      protocol: TLS
      tls:
        mode: Passthrough
      allowedRoutes:
        namespaces:
          from: All
  # -- Additional listeners to be added to the Gateway resource (e.g. for HTTPBin)
  listenersExtra:
    - name: terminate-services
      hostname: '*.services.portal.localhost'
      port: 8443
      protocol: HTTPS
      tls:
        mode: Terminate
        certificateRefs:
          - group: ""
            kind: Secret
            name: domain-certificate
            namespace: platform-mesh-system
      allowedRoutes:
        namespaces:
          from: All
