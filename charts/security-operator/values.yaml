image:
  name: ghcr.io/platform-mesh/security-operator

# -- environment indicator, used for logging and observability
environment: local
# -- region indicator, used for logging and observability
region: local

deployment:
  revisionHistoryLimit: 3
  resources:
    limits:
      cpu: 260m
      memory: 512Mi
    requests:
      cpu: 150m
      memory: 128Mi

crds:
  enabled: false

logLevel: info

# -- The kubeconfig secret for operator and generator
kubeconfigSecret: ""

keycloakSecret: "keycloak-admin"
caSecret: ""

baseDomain: "portal.localhost:8443"

keycloak:
  client:
    secret:
      name: security-operator-client-secret
      key: client_secret

initializer:
  # -- The kubeconfig secret for the initializer
  kubeconfigSecret: ""
  extraArgs: []

# -- Init container configuration for bootstrapping Keycloak service account clients
initContainer:
  # -- Enable the init container
  enabled: true
  # -- Keycloak base URL (e.g., https://keycloak.example.com). If empty, derived from baseDomain.
  keycloakBaseURL: ""
  # -- Keycloak client ID for admin authentication
  keycloakClientId: admin-cli
  # -- Keycloak username for admin authentication
  keycloakUser: keycloak-admin
  # -- Service account clients to create (beyond the default one from keycloak.client.secret)
  clients:
  - name: security-operator
    secretRef:
      name: security-operator-client-secret
      namespace: platform-mesh-system
  - name: iam-service
    secretRef:
      name: iam-client-secret
      namespace: platform-mesh-system

generator:
  extraArgs: []
fga:
  target: openfga.platform-mesh-system.svc.cluster.local:8081
  inviteKeycloakBaseUrl: ""
  setDefaultPassword: false
  extraArgs: []

hostAliases:
  enabled: false

coreModule: |-

  module core

  type user

  type role
    relations
      define assignee: [user,user:*]

  type core_platform-mesh_io_account
    relations
      define parent: [core_platform-mesh_io_account]

      define owner: [role#assignee] or owner from parent
      define member: [role#assignee] or owner

      define get: member
      define update: member
      define patch: member
      define delete: owner

      define create_core_platform-mesh_io_accounts: member
      define list_core_platform-mesh_io_accounts: member
      define watch_core_platform-mesh_io_accounts: member

      # org and account specific
      define watch: member

      define create_core_platform-mesh_io_accountinfos: member
      define list_core_platform-mesh_io_accountinfos: member
      define watch_core_platform-mesh_io_accountinfos: member

      define list_core_kcp_io_logicalclusters: member
      define watch_core_kcp_io_logicalclusters: member

      # IAM specific
      define manage_iam_roles: owner
      define get_iam_roles: member
      define get_iam_users: member

  type core_platform-mesh_io_accountinfo
    relations
      define parent: [core_platform-mesh_io_account]

      define member: member from parent
      define owner: owner from parent

      define get: member
      define watch: member

      # IAM specific
      define manage_iam_roles: owner
      define get_iam_roles: member
      define get_iam_users: member

  type core_kcp_io_logicalcluster
    relations
      define parent: [core_platform-mesh_io_account]

      define member: member from parent

      define get: member
      define watch: member
