apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "common.entity.name" . }}
spec:
  {{ include "common.deploymentBasics" . | indent 2}}
  template:
    metadata:
      labels:
        {{- include "common.labelMatcher" . | indent 8 }}
    spec:
      containers:
      - {{- include "common.podBasics" . | indent 8 }}
        args:
          - --webroot={{ .Values.domain.pathPrefix | default "/" }}
          - --smtp-auth-accept-any
          - --smtp-auth-allow-insecure
        ports:
        - name: ui
          containerPort: 8025
          protocol: TCP
        - name: smtp
          containerPort: 1025
          protocol: TCP
      hostAliases:
      {{- if (.Values.deployment).hostAliases }}
      {{- range .Values.deployment.hostAliases }}
        - ip: {{ .ip }}
          hostnames:
        {{- range .hostnames }}
            - {{ . }}
        {{- end }}
      {{- end }}
      {{- end }}
