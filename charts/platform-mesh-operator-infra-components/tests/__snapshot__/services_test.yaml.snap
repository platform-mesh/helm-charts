disable all components:
  1: |
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: etcd-druid
      namespace: default
    spec:
      chart:
        spec:
          chart: charts
          reconcileStrategy: ChartVersion
          sourceRef:
            kind: GitRepository
            name: etcd-druid
      dependsOn: null
      interval: 1m
      releaseName: etcd-druid
      targetNamespace: etcd-druid-system
      timeout: 15m
      values: {}
  2: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: image
        component: etcd-druid
        repo: oci
      name: etcd-druid-image
    spec:
      componentRef:
        name: platform-mesh
      interval: 1m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: etcd-druid
          resource:
            name: image
  3: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: chart
        repo: git
      name: etcd-druid
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: etcd-druid
          resource:
            name: chart
      skipVerify: true
enable etcd-druid:
  1: |
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: etcd-druid
      namespace: default
    spec:
      chart:
        spec:
          chart: charts
          reconcileStrategy: ChartVersion
          sourceRef:
            kind: GitRepository
            name: etcd-druid
      dependsOn: null
      interval: 1m
      releaseName: etcd-druid
      targetNamespace: etcd-druid-system
      timeout: 15m
      values: {}
  2: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: image
        component: etcd-druid
        repo: oci
      name: etcd-druid-image
    spec:
      componentRef:
        name: platform-mesh
      interval: 1m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: etcd-druid
          resource:
            name: image
  3: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: chart
        repo: git
      name: etcd-druid
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: etcd-druid
          resource:
            name: chart
      skipVerify: true
it should render the application manifests:
  1: |
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: cert-manager
    spec:
      chartRef:
        kind: OCIRepository
        name: cert-manager
        namespace: default
      interval: 1m
      releaseName: cert-manager
      targetNamespace: default
      timeout: 30m
      values:
        crds:
          enabled: true
  2: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      annotations:
        artifact: image
        for: cert-manager
        path: cainjector.image.tag
        repo: oci
      name: cert-manager-cainjector-image
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: cert-manager
          resource:
            name: cainjector-image
      skipVerify: true
  3: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      annotations:
        artifact: image
        for: cert-manager
        repo: oci
      name: cert-manager-controller-image
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: cert-manager
          resource:
            name: controller-image
      skipVerify: true
  4: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      annotations:
        artifact: image
        for: cert-manager
        path: webhook.image.tag
        repo: oci
      name: cert-manager-webhook-image
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: cert-manager
          resource:
            name: webhook-image
      skipVerify: true
  5: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: chart
        repo: oci
      name: cert-manager
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: cert-manager
          resource:
            name: chart
      skipVerify: true
  6: |
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: etcd-druid
      namespace: default
    spec:
      chart:
        spec:
          chart: charts
          reconcileStrategy: ChartVersion
          sourceRef:
            kind: GitRepository
            name: etcd-druid
      dependsOn: null
      interval: 1m
      releaseName: etcd-druid
      targetNamespace: etcd-druid-system
      timeout: 15m
      values: {}
  7: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: image
        component: etcd-druid
        repo: oci
      name: etcd-druid-image
    spec:
      componentRef:
        name: platform-mesh
      interval: 1m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: etcd-druid
          resource:
            name: image
  8: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: chart
        repo: git
      name: etcd-druid
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: etcd-druid
          resource:
            name: chart
      skipVerify: true
  9: |
    apiVersion: kustomize.toolkit.fluxcd.io/v1
    kind: Kustomization
    metadata:
      name: gateway-api
    spec:
      force: false
      install:
        crds: Skip
      interval: 1m
      path: ./config/crd/experimental
      prune: true
      sourceRef:
        kind: GitRepository
        name: gateway-api
  10: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: chart
        repo: git
      name: gateway-api
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: gateway-api
          resource:
            name: crds
      skipVerify: true
  11: |
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: traefik-crds
    spec:
      chart:
        spec:
          chart: traefik-crds
          reconcileStrategy: ChartVersion
          sourceRef:
            kind: HelmRepository
            name: traefik-crds
      dependsOn: null
      interval: 1m
      releaseName: traefik-crds
      targetNamespace: default
      timeout: 30m
  12: |
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: traefik
    spec:
      chart:
        spec:
          chart: traefik
          reconcileStrategy: ChartVersion
          sourceRef:
            kind: HelmRepository
            name: traefik
      dependsOn:
        - name: traefik-crds
      interval: 1m
      releaseName: traefik
      targetNamespace: default
      timeout: 30m
      values:
        experimental:
          kubernetesGateway:
            enabled: true
        gateway:
          enabled: false
        gatewayClass:
          enabled: true
        ports:
          websecure:
            exposedPort: 8443
            nodePort: 31000
        providers:
          kubernetesGateway:
            enabled: true
            experimentalChannel: true
        service:
          spec:
            clusterIP: 10.96.188.4
          type: NodePort
  13: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: chart
        repo: helm
      name: traefik-crds
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: traefik
          resource:
            name: crds
      skipVerify: true
  14: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      annotations:
        artifact: image
        for: traefik
        repo: oci
      name: traefik-image
      namespace: default
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: traefik
          resource:
            name: image
      skipVerify: true
  15: |
    apiVersion: delivery.ocm.software/v1alpha1
    kind: Resource
    metadata:
      labels:
        artifact: chart
        repo: helm
      name: traefik
    spec:
      componentRef:
        name: platform-mesh
      interval: 3m
      ocmConfig:
        - apiVersion: delivery.ocm.software/v1alpha1
          kind: Repository
          name: platform-mesh
          namespace: default
      resource:
        byReference:
          referencePath:
            - name: traefik
          resource:
            name: chart
      skipVerify: true
