suite: Test the Template files
values:
- ../values.yaml
- ../test_values.yaml
release:
  name: platform-mesh
  namespace: platform-mesh-system
chart:
  appVersion: 1.0.0
templates:
  - clusterrole.yaml
  - clusterrolebinding.yaml
  - role.yaml
  - rolebinding.yaml
tests:
  - it: matches the Snapshot
    asserts:
    - matchSnapshot: {}
  - it: matches the Snapshot with internal rbac creation enabled
    set:
      kubeConfig.enabled: false
      kcp.enabled: false
    asserts:
      - matchSnapshot: {}
  - it: matches the Snapshot with service account RBAC rules enabled
    set:
      kubeConfig.enabled: false
      kcp.enabled: false
      rbac.createServiceAccountRules: true
    asserts:
      - matchSnapshot: {}
  - it: matches the Snapshot with namespace-scoped service account roles
    set:
      kubeConfig.enabled: false
      kcp.enabled: false
      rbac.createServiceAccountRules: true
      rbac.serviceAccounts:
        - name: my-service-account
          namespace: my-namespace
        - name: another-sa
          namespace: another-namespace
        - name: second-sa
          namespace: my-namespace
    asserts:
      - matchSnapshot: {}