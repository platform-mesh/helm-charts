apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: ocm-k8s-toolkit
  namespace: default
spec:
  postRenderers:
    - kustomize:
        patches:
          - target:
              kind: Deployment
            patch: |
              apiVersion: apps/v1
              kind: Deployment
              metadata:
                name: controller-manager
              spec:
                template:
                  spec:
                    containers:
                      - name: manager
                        env:
                          - name: SSL_CERT_FILE
                            value: /etc/ocm/ca/registry-ca.pem
                        volumeMounts:
                          - name: custom-ca
                            mountPath: /etc/ocm/ca
                            readOnly: true
                    volumes:
                      - name: custom-ca
                        configMap:
                          name: ocm-custom-ca
