apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: ocm-k8s-toolkit
  namespace: default
spec:
  releaseName: ocm-k8s-toolkit
  interval: 1m
  timeout: 15m
  targetNamespace: ocm-system
  chart:
    spec:
      chart: ocm-k8s-toolkit
      version: "0.1.0"
      sourceRef:
        kind: HelmRepository
        name: ocm-charts
  values:
    manager:
      concurrency:
        resource: 21
      logging:
        level: "4"
  postRenderers:
    - kustomize:
        patches:
          - target:
              kind: Deployment
              name: ocm-k8s-toolkit-controller-manager
            patch: |
              apiVersion: apps/v1
              kind: Deployment
              metadata:
                name: ocm-k8s-toolkit-controller-manager
              spec:
                template:
                  spec:
                    containers:
                      - name: manager
                        env:
                          - name: SSL_CERT_FILE
                            value: /etc/ocm/ca/registry-ca.pem
                        volumeMounts:
                          - name: custom-ca
                            mountPath: /etc/ocm/ca
                            readOnly: true
                    volumes:
                      - name: custom-ca
                        configMap:
                          name: ocm-custom-ca
